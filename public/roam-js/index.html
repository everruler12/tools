<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erik's {{roam/js}} Scripts</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <!-- <script src="/assets/jquery-3.5.1.min.js"></script> -->
    <script src="/assets/vue-2.6.12.js"></script>
    <link rel="stylesheet" href="/assets/bulma.min.css">
    <style>
    </style>
</head>

<body>
    <!-- <section id="vm-app-bookmarklets" class="section">
        <div class="container">
            <h1 class="title">Bookmarklets</h1>
            <p>Instructions: Drag the button to your bookmarks bar. The bookmarklet will run the script on the active page when clicked.</p>
            <p v-for="bm in bookmarklets">
                <a class="button bookmarklet" :href="bm.url" @click.prevent>{{bm.name}}</a>
                <span>{{bm.description}}</span>
            </p>
        </div>
    </section>


    <script>
        var vm = new Vue({
            el: "#vm-app-bookmarklets",
            data: {
                bookmarklets: [{
                    "name": "jQuerify",
                    "url": "javascript:%3B(()%3D%3E%7B%0Aif%20(window.jQuery)%20%7B%0Aconsole.log(%60jQuerify%3A%20Already%20loaded%60)%0Areturn%0A%7D%0A%0Alet%20s%20%3D%20document.createElement('script')%0As.src%20%3D%20%22https%3A%2F%2Fcdnjs.cloudflare.com%2Fajax%2Flibs%2Fjquery%2F3.5.1%2Fjquery.min.js%22%0Adocument.head.appendChild(s)%0A%0Alet%20counter%20%3D%200%0Alet%20timeoutLength%20%3D%205%0Alet%20timeoutLimit%20%3D%201000%0A%0AwaitForLoad()%0A%0Afunction%20waitForLoad()%20%7B%0Aif%20(counter%20*%20timeoutLength%20%3E%3D%20timeoutLimit)%20%7B%0Aconsole.log(%60jQuerify%3A%20Timed-out%20after%20%24%7BtimeoutLimit%7D%20ms%60)%0Aalert('Error%3A%20jQuery%20not%20loaded.')%0Areturn%0A%7D%20else%20if%20(window.jQuery)%20%7B%0Aconsole.log(%60jQuerify%3A%20Loaded%20after%20%24%7Bcounter%20*%20timeoutLength%7D%20ms%60)%0A%7D%20else%20%7B%0Acounter%2B%2B%0AsetTimeout(waitForLoad%2C%20timeoutLength)%0A%7D%0A%7D%7D)()%3B",
                    "description": "Adds jQuery to the webpage. Useful for testing things in DevTools console.",
                    "src": ""
                }, {
                    "name": "Copy Title & Url",
                    "url": "javascript:%3B(()%3D%3E%7B(function()%20%7B%0Afunction%20getURL()%20%7B%0Areturn%20document.URL%0A%7D%0A%0Afunction%20getTitle(url)%20%7B%0Aif%20(url.indexOf('mail.google.com')%20!%3D%3D%20-1)%20%7B%0Areturn%20document.title.replace(%2F%20-%20.*%3F%40gmail%5C.com%20-%20Gmail%24%2F%2C%20'%20-%20Gmail')%0A%7D%20else%20%7B%0Areturn%20document.title%0A%7D%0A%7D%0A%0Aconst%20url%20%3D%20getURL()%0Aconst%20title%20%3D%20getTitle(url)%0A%0AcopyLink(url%2C%20title)%0A%0Afunction%20copyLink(url%2C%20title)%20%7B%0Afunction%20listener(e)%20%7B%0Ae.clipboardData.setData(%22text%2Fplain%22%2C%20title%20%2B%20'%5Cn'%20%2B%20url)%0Ae.clipboardData.setData(%22text%2Fhtml%22%2C%20%60%3Ca%20href%3D%22%24%7Burl%7D%22%3E%24%7Btitle%7D%3C%2Fa%3E%60)%0Ae.preventDefault()%0A%7D%0A%0Adocument.addEventListener(%22copy%22%2C%20listener)%0A%0Atry%20%7B%0Adocument.execCommand(%22copy%22)%0Aconsole.log(%22Copied%3A%20%5Cn%22%2C%20%7B%0Atitle%2C%0Aurl%0A%7D)%0A%7D%20catch%20(e)%20%7B%0Aconsole.log(%22Copy%20failed.%22%2C%20e)%0A%7D%20finally%20%7B%0Adocument.removeEventListener(%22copy%22%2C%20listener)%0A%7D%0A%7D%0A%7D)()%7D)()%3B",
                    "description": "Copies a webpage's title and URL. Will be pasted as a link if supported in app (Roam, Notion, Circle, Gmail, etc.), or else as plain text separated with a linebreak (Zoom, Notepad, etc.).",
                    "src": ""
                }]
                // , {
                //     "name": "",
                //     "url": "",
                //     "description": "",
                //     "src": ""
                // }
            },

            methods: {

            },

            mounted() {

            }
        })
    </script> -->

    <section id="vm-app-roam-clipboard" class="section">
        <div class="container">
            <h1 class="title">Roam Clipboard</h1>
            <p>Instructions: Copy Roam blocks and paste in the textarea below to create an HTML copy button.</p>
            <div class="columns">
                <div class="column">
                    <input v-model="name" placeholder="Name" @focus="$event.target.select()">
                    <!-- <textarea id="clipboard-input" class="textarea" v-model="clipboard_input" placeholder="Paste here" @focus="clipboard_input=''" @paste="clipboard_input=''"></textarea> -->
                    <textarea id="clipboard-input" class="textarea" placeholder="Paste here" @paste="clipboard_input=''"></textarea>
                </div>

                <div class="column">
                    <p>Clipboard data:</p>
                    <textarea class="textarea" v-model="output_pretty" readonly></textarea>
                    <button class="button" @click="copyRoamData(clipboard_output)">Copy</button>
                    <button class="button" @click="clipboard_output={}">Clear</button>
                    <!-- <span>Bookmarklet to drag:</span> -->
                    <!-- <a class="button bookmarklet" :href="url" @click.prevent>{{name}}</a> -->
                </div>
            </div>


        </div>
    </section>

    <script>
        // if no roam/data, convert script into roam data
        var vm = new Vue({
            el: "#vm-app-roam-clipboard",
            data: {
                name: 'Roam blocks', // text input
                clipboard_input: '', // textarea, listen for paste event
                clipboard_output: {},
                scripts: [{
                    name: 'add-highlights-escaped-from-bold-keyboard-shortcut',
                    clipboard_data: {
                        "text_plain": "\n{{roam/js}}\n    ```javascript\n/*\nAdd highlights escaped from bold with Ctrl/Cmd + Shift + H\nBy Erik Newhard\nhttps://roamresearch.com/#/app/roam-depot-developers/page/qIMQKcZh7\n*/\n\n;(function() {\n  let s = document.createElement('script')\n  s.src = \"https://tools.eriknewhard.com/roam-js/add-highlights-escaped-from-bold-keyboard-shortcut.js\"\n  document.head.appendChild(s)\n})();```\n\n",
                        "text_html": "<html>\r\n<body>\r\n<!--StartFragment--><div><p style=\"text-align:inherit;\"><span style=\"white-space:pre;\"></span><span style=\"text-align:inherit;\"><span></span></span></p><p style=\"text-align:inherit;\"><span style=\"white-space:pre;\"></span><span style=\"text-align:inherit;\"><span>{{roam/js}}</span></span><div><p style=\"text-align:inherit;\"><span style=\"white-space:pre;\">\t</span><span style=\"text-align:inherit;\"><span><pre><code>javascript\n/*\nAdd highlights escaped from bold with Ctrl/Cmd + Shift + H\nBy Erik Newhard\nhttps://roamresearch.com/#/app/roam-depot-developers/page/qIMQKcZh7\n*/\n\n;(function() {\n  let s = document.createElement('script')\n  s.src = \"https://tools.eriknewhard.com/roam-js/add-highlights-escaped-from-bold-keyboard-shortcut.js\"\n  document.head.appendChild(s)\n})();</code></pre></span></span></p></div></p><p style=\"text-align:inherit;\"><span style=\"white-space:pre;\"></span><span style=\"text-align:inherit;\"><span></span></span></p></div><!--EndFragment-->\r\n</body>\r\n</html>",
                        "roam_data": "[\"^ \",\"~:db-id\",\"roam-depot-developers\",\"~:type\",\"~:copy\",\"~:copied-data\",[[\"^ \",\"~:block/string\",\"\",\"~:children/view-type\",\"~:document\",\"~:create/email\",\"erik.newhard@gmail.com\",\"~:create/time\",1600921187513,\"~:block/uid\",\"BNNgX6o0l\",\"~:block/open\",true,\"~:edit/time\",1600924748968,\"~:edit/email\",\"erik.newhard@gmail.com\",\"~:block/order\",7],[\"^ \",\"^4\",\"{{roam/js}}\",\"^7\",\"erik.newhard@gmail.com\",\"^8\",1600920980996,\"~:block/children\",[[\"^ \",\"^4\",\"~```javascript\\n/*\\nAdd highlights escaped from bold with Ctrl/Cmd + Shift + H\\nBy Erik Newhard\\nhttps://roamresearch.com/#/app/roam-depot-developers/page/qIMQKcZh7\\n*/\\n\\n;(function() {\\n  let s = document.createElement('script')\\n  s.src = \\\"https://tools.eriknewhard.com/roam-js/add-highlights-escaped-from-bold-keyboard-shortcut.js\\\"\\n  document.head.appendChild(s)\\n})();```\",\"^7\",\"erik.newhard@gmail.com\",\"^8\",1600921175646,\"^9\",\"f9f1BFs5H\",\"^:\",true,\"^;\",1600964872243,\"^<\",\"erik.newhard@gmail.com\",\"^=\",0]],\"^9\",\"-zI-sl2wA\",\"^:\",true,\"^;\",1600920988194,\"^<\",\"erik.newhard@gmail.com\",\"^=\",8],[\"^ \",\"^4\",\"\",\"^7\",\"erik.newhard@gmail.com\",\"^8\",1600924350980,\"^9\",\"pu3Br1Ssw\",\"^:\",true,\"^;\",1600924763834,\"^<\",\"erik.newhard@gmail.com\",\"^=\",9]]]"
                    }
                }]
            },

            computed: {
                output_pretty() {
                    return JSON.stringify(this.clipboard_output, null, 2)
                },
            },

            mounted() {
                // if (window.location.search) {
                //     let pairs = window.location.search.substring(1) // query
                //         .split('&') // pairs
                //         .map(pair => {
                //             pair = pair.split('=')
                //             return {
                //                 name: pair[0],
                //                 value: decodeURIComponent(pair[1])
                //             }
                //         })


                // } else {
                this.listenForPaste()
                // }


            },

            methods: {
                listenForPaste() {
                    let _this = this
                    let el = document.getElementById("clipboard-input")
                    el.addEventListener("paste", function(e) {
                        // console.log(e.clipboardData)
                        let clipboard_data = {
                            text_plain: e.clipboardData.getData("text/plain"),
                            text_html: e.clipboardData.getData("text/html"),
                            roam_data: e.clipboardData.getData("roam/data")
                        }
                        // console.log(clipboard_data)

                        if (clipboard_data.roam_data == "")
                            alert("That is not valid roam/data")

                        _this.clipboard_output = clipboard_data
                    })
                },

                createIIFE(code) { // https://en.wikipedia.org/wiki/Immediately_invoked_function_expression
                    code = this.trimLines(code)
                    return `;(()=>{${code}})();`
                },

                trimLines(text) {
                    return text
                        .split(/\r?\n/)
                        .map(line => line.trim())
                        .filter(line => line != "")
                        .join('\n')
                },

                copy(text_to_copy) {
                    function listener(e) {
                        e.clipboardData.setData("text/plain", text_to_copy)
                        e.preventDefault()
                    }

                    document.addEventListener("copy", listener)

                    try {
                        document.execCommand("copy")
                        console.log("Copied:", text_to_copy)
                    } catch (e) {
                        console.log("Copy failed.", e)
                    } finally {
                        document.removeEventListener("copy", listener)
                    }
                },

                copyRoamData(clipboard_data) {
                    clipboard_data = JSON.parse(JSON.stringify(clipboard_data))

                    function listener(e) {
                        e.clipboardData.setData("text/plain", clipboard_data.text_plain)
                        e.clipboardData.setData("text/html", clipboard_data.text_html)
                        e.clipboardData.setData("roam/data", clipboard_data.roam_data)
                        e.preventDefault()
                    }

                    document.addEventListener("copy", listener)

                    try {
                        document.execCommand("copy")
                        console.log("Copied:", clipboard_data)
                    } catch (e) {
                        console.log("Copy failed.", e)
                    } finally {
                        document.removeEventListener("copy", listener)
                    }
                }
            },
        })
    </script>

</body>

</html>